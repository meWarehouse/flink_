

-- https://nightlies.apache.org/flink/flink-docs-release-1.15/docs/dev/table/sql/queries/joins/

CREATE TABLE IF NOT EXISTS order_table(
    order_id string,
    price decimal(10,2),
    currency string,
    order_time timestamp(3),
    watermark for order_time as order_time - interval '1' second
);

+--------------------------------+--------------------------------+--------------------------------+-------------------------+
|                       order_id |                          price |                       currency |              order_time |
+--------------------------------+--------------------------------+--------------------------------+-------------------------+
|                          90001 |                          10.09 |                            EUR | 2022-06-09 12:00:00.000 |
|                          90002 |                           15.5 |                         Dollar | 2022-06-09 11:56:06.000 |
+--------------------------------+--------------------------------+--------------------------------+-------------------------+


CREATE TABLE IF NOT EXISTS ship_table(
    id string,
    desc string,
    ship_time timestamp(3),
    watermark for ship_time as ship_time - interval '1' second
);

+--------------------------------+--------------------------------+-------------------------+
|                             id |                           desc |               ship_time |
+--------------------------------+--------------------------------+-------------------------+
|                          90001 |  十月稻田 长粒香大米 东北大... | 2022-06-09 12:00:00.000 |
|                          90002 |  Redmi 10X 4G Helio G85游戏... | 2022-06-09 11:56:06.000 |
|                          90003 | 索芙特i-Softto 口红不掉色唇... | 2022-06-09 12:01:20.000 |
|                          90001 | TCL 75Q10 75英寸 QLED原色量... | 2022-06-09 13:01:00.000 |
|                          90001 | 小米电视4A 70英寸 4K超高清 ... | 2022-06-09 13:05:56.000 |
+--------------------------------+--------------------------------+-------------------------+


CREATE TABLE IF NOT EXISTS rate_table(
    currency STRING,
    rate DECIMAL(10,2)
);

+--------------------------------+--------------------------------+
|                       currency |                           rate |
+--------------------------------+--------------------------------+
|                         Dollar |                          102.0 |
|                           Euro |                          114.0 |
|                           Yen  |                            1.0 |
+--------------------------------+--------------------------------+



-- =================================================== INNER Equi-JOIN

SELECT
    *
FROM order_table
INNER JOIN ship_table
ON order_table.order_id = ship_table.id



-- =================================================== OUTER Equi-JOIN

-- ================== LEFT JOIN

SELECT
    *
FROM order_table ot
LEFT JOIN ship_table st
ON ot.order_id = st.id;

+--------------------------------+--------------------------------+--------------------------------+-------------------------+--------------------------------+--------------------------------+-------------------------+
|                       order_id |                          price |                       currency |              order_time |                             id |                           desc |               ship_time |
+--------------------------------+--------------------------------+--------------------------------+-------------------------+--------------------------------+--------------------------------+-------------------------+
|                          90001 |                          10.09 |                            EUR | 2022-06-09 12:00:00.000 |                          90001 |  十月稻田 长粒香大米 东北大... | 2022-06-09 12:00:00.000 |
|                          90001 |                          10.09 |                            EUR | 2022-06-09 12:00:00.000 |                          90001 | TCL 75Q10 75英寸 QLED原色量... | 2022-06-09 13:01:00.000 |
|                          90001 |                          10.09 |                            EUR | 2022-06-09 12:00:00.000 |                          90001 | 小米电视4A 70英寸 4K超高清 ... | 2022-06-09 13:05:56.000 |
|                          90002 |                           15.5 |                         Dollar | 2022-06-09 11:56:06.000 |                          90002 |  Redmi 10X 4G Helio G85游戏... | 2022-06-09 11:56:06.000 |
+--------------------------------+--------------------------------+--------------------------------+-------------------------+--------------------------------+--------------------------------+-------------------------+

-- ================== RIGHT JOIN

SELECT
    *
FROM order_table ot
RIGHT JOIN  ship_table st
ON ot.order_id = st.id;

+--------------------------------+--------------------------------+--------------------------------+-------------------------+--------------------------------+--------------------------------+-------------------------+
|                       order_id |                          price |                       currency |              order_time |                             id |                           desc |               ship_time |
+--------------------------------+--------------------------------+--------------------------------+-------------------------+--------------------------------+--------------------------------+-------------------------+
|                          90001 |                          10.09 |                            EUR | 2022-06-09 12:00:00.000 |                          90001 |  十月稻田 长粒香大米 东北大... | 2022-06-09 12:00:00.000 |
|                          90001 |                          10.09 |                            EUR | 2022-06-09 12:00:00.000 |                          90001 | TCL 75Q10 75英寸 QLED原色量... | 2022-06-09 13:01:00.000 |
|                          90001 |                          10.09 |                            EUR | 2022-06-09 12:00:00.000 |                          90001 | 小米电视4A 70英寸 4K超高清 ... | 2022-06-09 13:05:56.000 |
|                          90002 |                           15.5 |                         Dollar | 2022-06-09 11:56:06.000 |                          90002 |  Redmi 10X 4G Helio G85游戏... | 2022-06-09 11:56:06.000 |
+--------------------------------+--------------------------------+--------------------------------+-------------------------+--------------------------------+--------------------------------+-------------------------+


-- ================== FULL OUTER JOIN

SELECT
    *
FROM order_table ot
FULL OUTER JOIN ship_table st
ON ot.order_id = st.id;

+--------------------------------+--------------------------------+--------------------------------+-------------------------+--------------------------------+--------------------------------+-------------------------+
|                       order_id |                          price |                       currency |              order_time |                             id |                           desc |               ship_time |
+--------------------------------+--------------------------------+--------------------------------+-------------------------+--------------------------------+--------------------------------+-------------------------+
|                          90001 |                          10.09 |                            EUR | 2022-06-09 12:00:00.000 |                          90001 |  十月稻田 长粒香大米 东北大... | 2022-06-09 12:00:00.000 |
|                          90001 |                          10.09 |                            EUR | 2022-06-09 12:00:00.000 |                          90001 | TCL 75Q10 75英寸 QLED原色量... | 2022-06-09 13:01:00.000 |
|                          90001 |                          10.09 |                            EUR | 2022-06-09 12:00:00.000 |                          90001 | 小米电视4A 70英寸 4K超高清 ... | 2022-06-09 13:05:56.000 |
|                          90002 |                           15.5 |                         Dollar | 2022-06-09 11:56:06.000 |                          90002 |  Redmi 10X 4G Helio G85游戏... | 2022-06-09 11:56:06.000 |
|                         <NULL> |                         <NULL> |                         <NULL> |                  <NULL> |                          90003 | 索芙特i-Softto 口红不掉色唇... | 2022-06-09 12:01:20.000 |
+--------------------------------+--------------------------------+--------------------------------+-------------------------+--------------------------------+--------------------------------+-------------------------+

-- =================================================== Interval Joins

90001    2022-06-09 11:50:00.000 < 2022-06-09 12:00:00.000 < 2022-06-09 12:10:00.000
90002    2022-06-09 11:46:06.000 < 2022-06-09 11:56:06.000 < 2022-06-09 12:06:06.000

SELECT
    *
FROM order_table ot,ship_table st
WHERE ot.order_id = st.id
AND ot.order_time BETWEEN st.ship_time - INTERVAL '10' MINUTE AND st.ship_time



SELECT
    *
FROM order_table ot,ship_table st
WHERE ot.order_id = st.id
AND ot.order_time BETWEEN ot.order_time - INTERVAL '10' MINUTE AND ot.order_time + INTERVAL '10' MINUTE


SELECT
    *
FROM order_table ot,ship_table st
WHERE ot.order_id = st.id
  AND st.ship_time BETWEEN ot.order_time - INTERVAL '10' MINUTE AND ot.order_time + INTERVAL '10' MINUTE

SELECT
    *
FROM order_table ot
INNER JOIN ship_table st
ON ot.order_id = st.id
AND st.ship_time BETWEEN ot.order_time - INTERVAL '10' MINUTE AND ot.order_time + INTERVAL '10' MINUTE

